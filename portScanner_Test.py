from scapy.all import *
import sys
import logging
logging.getLogger("scapy.runtime").setLevel(logging.error)

if len(sys.argv) != 4:   # python portScanner_Test.py 127.0.0.1 22 65500
    print("usage: %s target startport endport" % (sys.argv[0]))
    sys.exit(0)

target = str(sys.argv[1])
startport = str(sys.argv[2])
endport = str(sys.argv[3])
print("Scanning "+target + "for open TCP ports")

if startport == endport:
    endport += 1

for x in range(startport, endport):
    packet = IP(dst=target)/TCP(dport=x, flag='S')
    response = sr1(packet, timeout=0.5, verbose=0)
    # 0x12 code for syn-ack
    if response.haslayer(TCP) and response.getlayer(TCP).flag == 0x12:
        print("Port "+str(x)+" is open!")
    sr(IP(dst=target)/TCP(dport=response.sport, flag="R"),
       timeout=0.5, verbose=0)   # R in scapy is for RST

print("Scan is complete!z\n")
